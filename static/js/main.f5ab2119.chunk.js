(this["webpackJsonprabbit-viz"]=this["webpackJsonprabbit-viz"]||[]).push([[0],{289:function(e,t,n){e.exports=n.p+"static/media/logo.3938d65c.svg"},299:function(e,t,n){e.exports=n(633)},632:function(e,t,n){},633:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n(74),a=(n(304),n(305),n(643)),i=n(647),c=n(646),s=n(32),u=n(33),l=n(35),d=n(34),h=n(36),f=n(20),m=n(47),g=n(270),v=n(170),p=n(166);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E={height:30,width:180};function y(e){var t=p.cloneDeep(e);return function(e){var t=function(e){return e.nodes.map((function(e){return{id:e.id,metadata:w({},E,{id:e.id})}}))}(e),n=function(e){return e.links.map((function(e){return{from:e.source,to:e.target}})).filter((function(t){return e.nodes.find((function(e){return e.id===t.from}))&&e.nodes.find((function(e){return e.id===t.to}))}))}(e),r=new v.graphlib.Graph;return r.setGraph({rankdir:"LR",ranksep:100}),r.setDefaultEdgeLabel((function(){return{}})),t.forEach((function(e){r.setNode(e.id,e.metadata)})),n.forEach((function(e){e.from&&e.to&&r.setEdge(e.from,e.to)})),v.layout(r),r.nodes().map((function(e){return r.node(e)}))}(t).forEach((function(e){var n=t.nodes.find((function(t){return t.id===e.id}));n.x=e.x,n.y=e.y})),t}var O="rgb(0,192,255)",j="rgb(192,255,0)",C="rgb(153,0,147)",k={definition:{bindings:[],exchanges:[],parameters:[],policies:[],queues:[],vhosts:[]},isValid:!0,validate:function(e,t,n){return null}};function S(){return Object(f.a)(k,(function(e){e.isValid=!0}))}function x(e,t,n,r){var o=[],a=[],i=[],c=new m.DiagramModel,s=e.bindings.filter((function(e){return"All"===t.currentVhost||e.vhost===t.currentVhost}));(s.length>0?function(e){var t=[];return e.forEach((function(e){var n=t.findIndex((function(t){return t.vhost===e.vhost&&t.source===e.source&&t.destination===e.destination&&t.destinationType===e.destination_type}));-1===n?t.push({destination:e.destination,destinationType:e.destination_type,routingKeys:""===e.routing_key?[]:[e.routing_key],source:e.source,vhost:e.vhost}):""!==e.routing_key&&t[n].routingKeys.push(e.routing_key)})),t}(s):[]).forEach((function(e){var n,s,u=e.vhost,l="Exchange: ".concat(e.source," ").concat("All"===t.currentVhost?"(".concat(u,")"):""),d=o.find((function(e){return e.name===l}));void 0===d&&(d=D(l,O),o.push(d)),"queue"===e.destinationType?(s="Queue: ".concat(e.destination," ").concat("All"===t.currentVhost?"(".concat(u,")"):""),void 0===(n=a.find((function(e){return e.name===s})))&&(n=D(s,j),a.push(n))):(s="Exchange: ".concat(e.destination," ").concat("All"===t.currentVhost?"(".concat(u,")"):""),void 0===(n=o.find((function(e){return e.name===s})))&&(n=D(s,O),o.push(n)));var h=d.getOutPorts().length>0?d.getOutPorts()[0]:d.addOutPort("Out"),f=n.getInPorts().length>0?n.getInPorts()[0]:n.addInPort("In"),m=h.createLinkModel();m.setSourcePort(h),m.setTargetPort(f),t.showRoutingKeys&&e.routingKeys.forEach((function(e){return m.addLabel(e)})),t.showConnections&&"queue"===e.destinationType&&r.consumers.filter((function(t){return t.queue.name===e.destination})).forEach((function(e){if(void 0!==n){var t=D(e.channel_details.name,C);t.x=300,t.y=200;var r=t.addInPort("In"),o=n.getOutPorts().length>0?n.getOutPorts()[0]:n.addOutPort("Out"),a=r.createLinkModel();a.setSourcePort(o),a.setTargetPort(r),c.addNode(t),c.addLink(a)}})),i.push(m)}));var u=1,l=1;return o.forEach((function(e){e.getInPorts().length>0&&e.getOutPorts().length>0?(e.x=300,e.y=70*l,l++):(e.x=70,e.y=70*u,u++),c.addNode(e)})),a.forEach((function(e,t){e.x=530,e.y=70*(t+1),c.addNode(e)})),i.forEach((function(e){c.addLink(e)})),function(e,t){var n=y(t.serializeDiagram()),r=new m.DiagramModel;return r.deSerializeDiagram(n,e),r}(n,c)}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgb(0,192,255)";return new m.DefaultNodeModel(e,t)}var P={currentVhost:"",errors:[],selectVhost:function(e,t){return null},setZoomFunction:function(){return null},showRoutingKeys:!0,showConnections:!1,toggleShowConnections:function(){return null},toggleShowRoutingKeys:function(){return null},zoomToFit:function(){return null}};function R(){return Object(f.a)(P,(function(e){e.currentVhost="All"}))}var V=r.createContext(S()),z=r.createContext(R()),I=r.createContext({consumers:[],update:function(e){return null}}),F=n(44),T=n.n(F),K=n(291),N=n(87),q=n(55),A=n(642),L=n(634),M=n(57),_=n(271),B=n.n(_),W=n(58),H=n.n(W),J=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).handleConnect=function(e){e.preventDefault(),n.connect()},n.handleReload=function(e,t){return function(){var r=Object(N.a)(T.a.mark((function r(o){var a,i,c,s;return T.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o.preventDefault(),r.next=3,n.reload();case 3:a=r.sent,i=Object(K.a)(a,2),c=i[0],s=i[1],e(null,null,c),t(s);case 9:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()},n.handleChange=function(e){var t,r=e.target.name,o=e.target.value;if("host"===r)t={host:o},H.a.save("host",o,{path:"/"});else if("username"===r)t={username:o},H.a.save("username",o,{path:"/"});else{if("password"!==r)return;t={password:o},H.a.save("password",o,{path:"/"})}n.setState(t)};var r=H.a.load("host")||"localhost:15672",o=H.a.load("username")||"guest",a=H.a.load("password")||"guest";return n.state={apiClient:null,onReload:e.reloadCallback,isConnected:!1,host:r,username:o,password:a,connectionState:{consumers:[],update:function(e){return null}}},n.handleChange=n.handleChange.bind(Object(q.a)(n)),n.handleReload=n.handleReload.bind(Object(q.a)(n)),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(N.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connect();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(N.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("connecting..."),e.prev=1,t=B.a.create({baseURL:"http://".concat(this.state.host,"/api/"),timeout:1e4,auth:{username:this.state.username,password:this.state.password}}),e.next=5,t.request({method:"get",url:"definitions"});case 5:this.setState({apiClient:t,isConnected:!0}),console.log("connection successful..."),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),this.setState({isConnected:!1}),console.log("connection failed...");case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=Object(N.a)(T.a.mark((function e(){var t,n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.state.apiClient){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.state.apiClient.request({method:"get",url:"definitions"});case 4:return t=e.sent,e.next=7,this.state.apiClient.request({method:"get",url:"consumers"});case 7:return n=e.sent,e.abrupt("return",[t.request.response,n.data]);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.createElement(V.Consumer,null,(function(t){return r.createElement(I.Consumer,null,(function(n){return r.createElement("form",null,r.createElement(A.a,{name:"host",label:"Host",placeholder:"Hostname (address:port)",onChange:e.handleChange,value:e.state.host}),r.createElement("br",null),r.createElement(A.a,{name:"username",label:"Username",placeholder:"Username",onChange:e.handleChange,value:e.state.username}),r.createElement(A.a,{type:"password",name:"password",label:"Password",placeholder:"Password",onChange:e.handleChange,value:e.state.password}),r.createElement("br",null),r.createElement(L.a,{onClick:e.handleConnect,secondary:!0},r.createElement(M.a,{name:e.state.isConnected?"check":"ban"})," Connect"),r.createElement(L.a,{content:"Reload",onClick:e.handleReload(t.validate,n.update),primary:!0}))}))}))}}]),t}(r.Component);n(602);var Z=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={code:""},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement(V.Consumer,null,(function(e){return r.createElement("div",null,r.createElement(J,null))}))}}]),t}(r.Component),U=n(645),G=(n(604),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).engine=void 0,n.zoomFunctionSet=void 0,n.engine=new m.DiagramEngine,n.engine.installDefaultFactories(),n.zoomFunctionSet=!1,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.createElement(z.Consumer,null,(function(t){return r.createElement(I.Consumer,null,(function(n){return r.createElement(V.Consumer,null,(function(r){return r.definition.vhosts.length>0?e.renderDefinitionDiagram(r,t,n):e.renderMessageBox(t)}))}))}))}},{key:"renderMessageBox",value:function(e){return(new m.DiagramEngine).installDefaultFactories(),e.errors.length>0?r.createElement(U.a,{error:!0,header:"Invalid broker definition json",list:e.errors,attached:"top",icon:"exclamation circle"}):r.createElement(U.a,{content:"Please load a broker definition using the editor panel.",header:"No Broker Definition Present",info:!0,attached:"top",icon:"info circle"})}},{key:"renderDefinitionDiagram",value:function(e,t,n){var o=this,a=x(e.definition,t,this.engine,n);return this.engine.setDiagramModel(a),this.zoomFunctionSet||(t.setZoomFunction((function(){o.engine.zoomToFit()})),this.zoomFunctionSet=!0),r.createElement(m.DiagramWidget,{className:"srd-canvas",diagramEngine:this.engine,inverseZoom:!0})}}]),t}(r.Component)),Q=n(648),$=n(644);var X=function(){return r.createElement(z.Consumer,null,(function(e){return r.createElement(V.Consumer,null,(function(t){return t.definition.vhosts.length>0?r.createElement(c.a,{attached:"top"},function(e,t,n){var o=function(e){var t=[{key:"All",value:"All",text:"All"}];return e.forEach((function(e){return t.push({key:e.name,value:e.name,text:e.name})})),t}(e);return r.createElement(c.a.Item,null,"Virtual Host:\xa0",r.createElement($.a,{placeholder:"Virtual Hosts",value:t,selection:!0,options:o,onChange:n}))}(t.definition.vhosts,e.currentVhost,e.selectVhost),r.createElement(c.a.Item,null,r.createElement(Q.a,{toggle:!0,label:"Show Routing Keys",onChange:e.toggleShowRoutingKeys,checked:e.showRoutingKeys})),r.createElement(c.a.Item,null,r.createElement(Q.a,{toggle:!0,label:"Show Connections",onChange:e.toggleShowConnections,checked:e.showConnections})),r.createElement(c.a.Item,null,r.createElement(L.a,{onClick:e.zoomToFit,content:"Zoom to Fit"}))):""}))}))},Y=n(290),ee=n(289),te=n.n(ee),ne=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement(c.a,{fixed:"top",inverted:!0},r.createElement(a.a,{fluid:!0},r.createElement(c.a.Item,{header:!0,as:"h4"},r.createElement(Y.a,{size:"mini",src:te.a,style:{marginRight:"1.5em"}}),"Rabbit Viz"),r.createElement(c.a.Item,{position:"right",href:"https://github.com/plexsystems/rabbit-viz",target:"_blank"},r.createElement(M.a,{name:"github",size:"big"}),"Fork us on GitHub!")))}}]),t}(r.Component),re=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).state={clusterDefinition:Object(f.a)(S(),(function(e){e.validate=n.validateDefinitionsJson.bind(Object(q.a)(n))})),viewState:Object(f.a)(R(),(function(e){e.selectVhost=function(e,t){n.setState(Object(f.a)((function(e){e.viewState.currentVhost=t.value})))},e.setZoomFunction=function(e){n.setState(Object(f.a)((function(t){t.viewState.zoomToFit=e})))},e.toggleShowRoutingKeys=function(){n.setState(Object(f.a)((function(e){e.viewState.showRoutingKeys=!e.viewState.showRoutingKeys})))},e.toggleShowConnections=function(){n.setState(Object(f.a)((function(e){e.viewState.showConnections=!e.viewState.showConnections})))}})),connectionState:Object(f.a)({consumers:[],update:function(e){return null}},(function(e){e.update=function(e){n.setState(Object(f.a)((function(t){t.connectionState.consumers=e})))}}))},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement(z.Provider,{value:this.state.viewState},r.createElement(V.Provider,{value:this.state.clusterDefinition},r.createElement(I.Provider,{value:this.state.connectionState},this.props.children)))}},{key:"validateDefinitionsJson",value:function(e,t,n){if(n.length>0)try{var r=JSON.parse(n);r.vhosts=r.vhosts.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),this.setState(Object(f.a)((function(e){e.clusterDefinition.isValid=!0,e.viewState.errors=[],e.clusterDefinition.definition=r})))}catch(o){return void this.setState(Object(f.a)((function(e){e.clusterDefinition.isValid=!1,e.viewState.errors=[o.message],e.clusterDefinition.definition={bindings:[],exchanges:[],parameters:[],policies:[],queues:[],vhosts:[]}})))}else this.setState(Object(f.a)((function(e){e.clusterDefinition.isValid=!0,e.viewState.errors=[],e.clusterDefinition.definition={bindings:[],exchanges:[],parameters:[],policies:[],queues:[],vhosts:[]}})))}}]),t}(r.Component),oe=function(){return r.createElement(re,null,r.createElement(ne,null),r.createElement(a.a,{fluid:!0},r.createElement(i.a,{style:{height:"100vh"},centered:!0,celled:"internally"},r.createElement(i.a.Row,{style:{height:"100%"}},r.createElement(i.a.Column,{width:12,style:{padding:0,marginTop:"4.5em",marginBottom:"2.5em"},className:"srd-container"},r.createElement(X,null),r.createElement(G,null)),r.createElement(i.a.Column,{width:4,style:{padding:0,marginTop:"4.5em",marginBottom:"2.5em"}},r.createElement(Z,null))))),r.createElement(c.a,{fixed:"bottom",inverted:!0},r.createElement(c.a.Item,{header:!0,position:"right"},"\xa9 2019 Plex Systems, Inc. All Rights Reserved.")))},ae=(n(632),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function ie(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.render(r.createElement(oe,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/rabbit-viz",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/rabbit-viz","/service-worker.js");ae?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ie(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ie(e)}))}}()}},[[299,1,2]]]);
//# sourceMappingURL=main.f5ab2119.chunk.js.map